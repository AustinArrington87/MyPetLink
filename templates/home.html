{% extends "base.html" %}

{% block title %}MyPetLink - Pet Health Analysis{% endblock %}

{% block content %}
<style>
    body {
        background: linear-gradient(135deg, #f0f7ff 0%, #fff5f5 100%);
        background-attachment: fixed;
    }

    .welcome-card {
        background-color: white;
        background-image: 
            radial-gradient(circle at 100% 100%, rgba(246, 173, 85, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 0% 0%, rgba(246, 173, 85, 0.05) 0%, transparent 50%);
    }

    .analysis-card {
        background-color: white;
        background-image: 
            radial-gradient(circle at 100% 100%, rgba(66, 153, 225, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 0% 0%, rgba(66, 153, 225, 0.05) 0%, transparent 50%);
    }

    .chat-card {
        background-color: white;
        background-image: 
            radial-gradient(circle at 100% 100%, rgba(72, 187, 120, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 0% 0%, rgba(72, 187, 120, 0.05) 0%, transparent 50%);
    }

    .upload-zone {
        border: 2px dashed #93C5FD;
        transition: all 0.3s ease;
    }

    .upload-zone:hover {
        border-color: #3B82F6;
        transform: scale(1.01);
    }

    .paw-print {
        position: absolute;
        opacity: 0.1;
        transform: rotate(45deg);
        pointer-events: none;
    }

    .chat-message {
        line-height: 1.6;
    }

    .chat-message p {
        margin-bottom: 0.75rem;
    }

    .chat-message ul, 
    .chat-message ol {
        margin: 1rem 0;
        padding-left: 1.5rem;
    }

    .chat-message li {
        margin-bottom: 0.5rem;
    }

    .analysis-section {
        background: white;
        border-radius: 1rem;
        padding: 1.5rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .analysis-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
</style>

<div class="fixed top-0 left-0 right-0 bg-white z-50 border-b border-gray-100">
    <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
        <a href="{{ url_for('home') }}">
            <img src="{{ url_for('static', filename='img/pet_logo_text.png') }}" 
                 alt="MyPetLink Logo" 
                 class="h-8 drop-shadow-md hover:drop-shadow-lg transition-all duration-300">
        </a>
        <a href="{{ url_for('profile') }}" 
           class="text-gray-600 hover:text-gray-900 transition-colors duration-200 flex items-center">
            <span class="mr-1">üêæ</span> Pet Profile
        </a>
    </div>
</div>

<div class="max-w-4xl mx-auto mt-20 px-4">
    <!-- Welcome Message -->
    <div class="welcome-card rounded-2xl p-6 shadow-lg mb-8 relative overflow-hidden">
        <div class="paw-print text-8xl absolute -top-4 -right-4">üêæ</div>
        <h1 class="text-2xl font-bold mb-4 text-orange-800">Welcome, {{ user_name }}! üêæ</h1>
        <p class="text-gray-600 relative z-10">
            Let's take care of your furry friend! Upload vet records, check their health, or get personalized tips.
        </p>
    </div>

    <!-- Vet Record Analysis -->
    <div class="analysis-card rounded-2xl p-6 shadow-lg mb-6">
        <h2 class="text-xl font-semibold mb-4 text-blue-800 flex items-center">
            <span class="text-2xl mr-2">üìã</span> Analyze Veterinary Records
        </h2>
        <div class="upload-zone rounded-xl p-6 text-center bg-blue-50 relative overflow-hidden" id="dropZone">
            <input type="file" 
                   id="fileInput" 
                   multiple 
                   class="hidden" 
                   accept=".pdf,.png,.jpg,.jpeg,.txt">
            <button type="button" 
                    onclick="document.getElementById('fileInput').click()" 
                    class="bg-blue-500 text-white px-6 py-3 rounded-full hover:bg-blue-600 transform transition-all hover:scale-105 shadow-md">
                + Add Documents
            </button>
            <p class="text-gray-600 mt-3">Upload vet records, lab results, or vaccination records</p>
            <div class="paw-print text-6xl absolute -bottom-4 -right-4 opacity-5">üêæ</div>
        </div>
    </div>

    <!-- Add this after the Vet Record Analysis section -->
    <div class="analysis-card rounded-2xl p-6 shadow-lg mb-6">
        <h2 class="text-xl font-semibold mb-4 text-green-800 flex items-center">
            <span class="text-2xl mr-2">üí©</span> Poop Analyzer
        </h2>
        <div class="upload-zone rounded-xl p-6 text-center bg-green-50 relative overflow-hidden" id="poopDropZone">
            <input type="file" 
                   id="poopFileInput" 
                   class="hidden" 
                   accept=".jpg,.jpeg,.png">
            <button type="button" 
                    onclick="document.getElementById('poopFileInput').click()" 
                    class="bg-green-500 text-white px-6 py-3 rounded-full hover:bg-green-600 transform transition-all hover:scale-105 shadow-md">
                + Add Photo
            </button>
            <p class="text-gray-600 mt-3">Upload a clear photo of your pet's poop for analysis</p>
            <div class="paw-print text-6xl absolute -bottom-4 -right-4 opacity-5">üí©</div>
        </div>
    </div>

    <!-- Add this after the poop analyzer section -->
    <div class="analysis-card rounded-2xl p-6 shadow-lg mb-6">
        <h2 class="text-xl font-semibold mb-4 text-purple-800 flex items-center">
            <span class="text-2xl mr-2">üéæ</span> Breed-Specific Training & Play Tips
        </h2>
        <div class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Species</label>
                    <select id="training-species" 
                            class="w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500">
                        <option value="">Select Species</option>
                        <option value="dog">Dog</option>
                        <option value="cat">Cat</option>
                        <option value="bird">Bird</option>
                        <option value="reptile">Reptile</option>
                        <option value="rabbit">Rabbit</option>
                        <option value="ferret">Ferret</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Breed</label>
                    <select id="training-breed" 
                            class="w-full rounded-lg border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500">
                        <option value="">Select Species First</option>
                    </select>
                </div>
            </div>
            <button onclick="getTrainingTips()"
                    class="w-full bg-purple-500 text-white px-6 py-3 rounded-full hover:bg-purple-600 transform transition-all hover:scale-105 shadow-md">
                Get Training & Play Tips
            </button>
        </div>
    </div>

    <!-- Analysis Results -->
    <div id="analysisResult" class="bg-white rounded-2xl p-6 shadow-lg mt-6 hidden">
        <h2 class="text-xl font-semibold mb-4 text-blue-800">Analysis Results</h2>
        <div class="space-y-4">
            <div class="bg-blue-50 p-4 rounded-xl">
                <div id="synopsis"></div>
            </div>
            <div class="bg-gray-50 p-4 rounded-xl">
                <div id="insights-anomalies"></div>
            </div>
            <div class="bg-green-50 p-4 rounded-xl">
                <div id="followup-actions"></div>
            </div>
        </div>
    </div>

    <!-- Add this for poop analysis results -->
    <div id="poopAnalysisResult" class="bg-white rounded-2xl p-6 shadow-lg mt-6 hidden">
        <h2 class="text-xl font-semibold mb-4 text-green-800">Poop Analysis Results</h2>
        <div class="space-y-4">
            <div class="bg-green-50 p-4 rounded-xl">
                <div id="poopSummary"></div>
            </div>
            <div class="bg-yellow-50 p-4 rounded-xl">
                <div id="poopConcerns"></div>
            </div>
            <div class="bg-blue-50 p-4 rounded-xl">
                <div id="poopRecommendations"></div>
            </div>
        </div>
    </div>

    <!-- Add this for training tips results -->
    <div id="trainingTipsResult" class="bg-white rounded-2xl p-6 shadow-lg mt-6 hidden">
        <h2 class="text-xl font-semibold mb-4 text-purple-800">Training & Play Tips</h2>
        <div class="space-y-4">
            <div class="bg-purple-50 p-4 rounded-xl">
                <h3 class="font-medium text-lg mb-2">Training Tips</h3>
                <div id="trainingTips"></div>
            </div>
            <div class="bg-blue-50 p-4 rounded-xl">
                <h3 class="font-medium text-lg mb-2">Exercise & Play</h3>
                <div id="playTips"></div>
            </div>
            <div class="bg-green-50 p-4 rounded-xl">
                <h3 class="font-medium text-lg mb-2">Enrichment Activities</h3>
                <div id="enrichmentTips"></div>
            </div>
        </div>
    </div>

    <!-- Add this after the training tips section -->
    <div class="analysis-card rounded-2xl p-6 shadow-lg mb-6">
        <h2 class="text-xl font-semibold mb-4 text-red-800 flex items-center">
            <span class="text-2xl mr-2">üÜò</span> Report Rescue Animal
        </h2>
        <button onclick="openRescueForm()" 
                class="w-full bg-red-500 text-white px-6 py-3 rounded-full hover:bg-red-600 transform transition-all hover:scale-105 shadow-md flex items-center justify-center">
            <span class="text-xl mr-2">+</span> Report Animal in Need
        </button>
    </div>

    <!-- Chat Section -->
    <div class="chat-card rounded-2xl p-6 shadow-lg mt-6">
        <div class="flex flex-col h-[400px]">
            <div id="chat-messages" class="flex-1 overflow-y-auto mb-4 space-y-4 relative">
                <div class="bg-blue-50 p-4 rounded-xl">
                    <p class="text-gray-700">
                        Hi! I'm your pet health assistant. I can help analyze vet records or provide care tips. What would you like to know? üêæ
                    </p>
                </div>
            </div>
            
            <div id="suggestedPrompts" class="mb-4 flex flex-wrap gap-2">
                <!-- Prompts will be dynamically populated -->
            </div>
            
            <div class="border-t pt-4">
                <form id="chat-form" class="flex gap-2">
                    <input type="text" 
                           id="chat-input" 
                           class="flex-1 border rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="Ask about your pet's health...">
                    <button type="submit" 
                            class="bg-blue-500 text-white px-6 py-2 rounded-xl hover:bg-blue-600 transform transition-all hover:scale-105 shadow-md">
                        Send
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Loading State -->
<div id="loadingState" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-4 rounded-xl shadow-xl text-center">
        <img src="/static/img/GIFs/cleo.gif" alt="Loading..." class="mx-auto h-24 w-24 object-contain mb-2">
        <p class="text-gray-600 text-sm">Analyzing documents...</p>
    </div>
</div>

<!-- Add this at the bottom of the body -->
<div id="rescueFormModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
    <div class="bg-white rounded-xl p-6 max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold text-red-800">Report Animal in Need üÜò</h3>
            <button onclick="closeRescueForm()" class="text-gray-500 hover:text-gray-700">
                <span class="text-2xl">√ó</span>
            </button>
        </div>
        
        <form id="rescueForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Location</label>
                <div class="flex gap-2 mb-2">
                    <button type="button" onclick="getCurrentLocation()" 
                            class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm hover:bg-blue-200">
                        üìç Use My Location
                    </button>
                </div>
                <input type="text" id="rescueLocation" required
                       class="w-full px-4 py-2 rounded-xl border-2 border-gray-200 focus:border-red-300 focus:ring focus:ring-red-200"
                       placeholder="Enter address or location">
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Species</label>
                    <select id="rescueSpecies" required
                            class="w-full px-4 py-2 rounded-xl border-2 border-gray-200 focus:border-red-300 focus:ring focus:ring-red-200">
                        <option value="">Select Species</option>
                        <option value="dog">Dog</option>
                        <option value="cat">Cat</option>
                        <option value="bird">Bird</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Breed (Optional)</label>
                    <input type="text" id="rescueBreed"
                           class="w-full px-4 py-2 rounded-xl border-2 border-gray-200 focus:border-red-300 focus:ring focus:ring-red-200"
                           placeholder="Enter breed if known">
                </div>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Health Issues/Situation</label>
                <textarea id="rescueDescription" required rows="4"
                         class="w-full px-4 py-2 rounded-xl border-2 border-gray-200 focus:border-red-300 focus:ring focus:ring-red-200"
                         placeholder="Describe the animal's condition and situation..."></textarea>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Your Email</label>
                <input type="email" id="rescueEmail" required
                       class="w-full px-4 py-2 rounded-xl border-2 border-gray-200 focus:border-red-300 focus:ring focus:ring-red-200"
                       placeholder="Enter your email address">
            </div>
            
            <button type="submit" 
                    class="w-full bg-red-500 text-white px-6 py-3 rounded-full hover:bg-red-600 transform transition-all hover:scale-105 shadow-md">
                üÜò Submit Report
            </button>
        </form>
    </div>
</div>

<script src="/static/js/pet_app.js"></script>
{% endblock %}
