{% extends "base.html" %}

{% block title %}Pet Profile{% endblock %}

{% block content %}
<div class="fixed top-0 left-0 right-0 bg-white z-50 border-b border-gray-100">
    <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
        <a href="{{ url_for('home') }}">
            <img src="{{ url_for('static', filename='img/pet_logo_text.png') }}" 
                 alt="MyPetLink Logo" 
                 class="h-8 drop-shadow-md hover:drop-shadow-lg transition-all duration-300">
        </a>
        <a href="{{ url_for('profile') }}" class="text-gray-600 hover:text-gray-900 transition-colors duration-200">Pet Profile</a>
    </div>
</div>

<div class="max-w-4xl mx-auto mt-20">
    <h1 class="text-3xl font-bold mb-8">Pet Profile</h1>
    
    <div class="bg-white shadow-md rounded-lg p-6">
        <h2 class="text-xl font-semibold mb-4">Basic Info</h2>
        <div class="grid grid-cols-2 gap-4">
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">Pet Name</label>
                <input type="text" id="petName" value="{{ pet.name if pet else '' }}" 
                       class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight">
            </div>
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">Species</label>
                <select id="petType" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight">
                    <option value="">Select species</option>
                    <option value="dog">Dog</option>
                    <option value="cat">Cat</option>
                    <option value="bird">Bird</option>
                    <option value="reptile">Reptile</option>
                    <option value="fish">Fish</option>
                    <option value="rabbit">Rabbit</option>
                    <option value="ferret">Ferret</option>
                    <option value="farm animal">Farm Animal</option>
                </select>
            </div>
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">Breed</label>
                <select id="breedSelect" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight">
                    <option value="">Select species first</option>
                </select>
            </div>
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">Age</label>
                <div class="flex gap-2">
                    <input type="number" id="ageYears" placeholder="Years" min="0" max="30"
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight">
                    <input type="number" id="ageMonths" placeholder="Months" min="0" max="11"
                           class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight">
                </div>
            </div>
        </div>
    </div>

    <div class="bg-white shadow-md rounded-lg p-6 mt-6">
        <h2 class="text-xl font-semibold mb-4">Health Information</h2>
        <div class="space-y-4">
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">Weight (lbs)</label>
                <input type="number" id="weight" step="0.1" min="0"
                       class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight">
            </div>
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">Health Conditions</label>
                <textarea id="healthConditions" rows="3"
                         class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight"
                         placeholder="List any ongoing health conditions..."></textarea>
            </div>
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">Last Checkup Date</label>
                <input type="date" id="lastCheckup"
                       class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight">
            </div>
        </div>
    </div>

    <div class="bg-white shadow-md rounded-lg p-6 mt-6">
        <h2 class="text-xl font-semibold mb-4">Location</h2>
        <div>
            <label class="block text-gray-700 text-sm font-bold mb-2">State</label>
            <select id="state" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight">
                <option value="">Select state</option>
                <!-- Add all US states -->
            </select>
        </div>
    </div>

    <div class="mt-6">
        <button onclick="saveProfile()" 
                class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
            Save Profile
        </button>
    </div>
</div>

<script>
// Add breed population based on species selection
document.getElementById('petType').addEventListener('change', function() {
    const petType = this.value;
    if (!petType) return;
    
    fetch(`/api/breeds/${petType}`)
        .then(response => response.json())
        .then(breeds => {
            const breedSelect = document.getElementById('breedSelect');
            breedSelect.innerHTML = '<option value="">Select breed</option>' +
                breeds.map(breed => `<option value="${breed}">${breed}</option>`).join('');
        })
        .catch(error => console.error('Error loading breeds:', error));
});

function saveProfile() {
    const data = {
        pet_name: document.getElementById('petName').value,
        species: document.getElementById('petType').value,
        breed: document.getElementById('breedSelect').value,
        age: {
            years: document.getElementById('ageYears').value,
            months: document.getElementById('ageMonths').value
        },
        weight: document.getElementById('weight').value,
        health_conditions: document.getElementById('healthConditions').value,
        last_checkup: document.getElementById('lastCheckup').value,
        state: document.getElementById('state').value
    };

    fetch('/update_pet_profile', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Profile saved successfully!');
            window.location.href = '/';
        } else {
            throw new Error(data.error || 'Failed to save profile');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Failed to save profile. Please try again.');
    });
}
</script>
{% endblock %}
